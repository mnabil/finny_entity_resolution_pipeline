{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-11-10T01:27:36.443502Z", "invocation_id": "e1ef99ff-b327-472a-b1d8-e3783eec0ab1", "invocation_started_at": "2025-11-10T01:27:35.923361Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.356912Z", "completed_at": "2025-11-10T01:27:36.359555Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.361606Z", "completed_at": "2025-11-10T01:27:36.361618Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006370067596435547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_service.fxf_data", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.359789Z", "completed_at": "2025-11-10T01:27:36.360590Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.361899Z", "completed_at": "2025-11-10T01:27:36.361903Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006127834320068359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_service.pdl_data", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.360781Z", "completed_at": "2025-11-10T01:27:36.361431Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.362122Z", "completed_at": "2025-11-10T01:27:36.362124Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.006093025207519531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.dbt_service.state_iso_mapping", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.365966Z", "completed_at": "2025-11-10T01:27:36.367452Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.367890Z", "completed_at": "2025-11-10T01:27:36.367897Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 0.004324674606323242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.raw_pdl_data", "compiled": true, "compiled_code": "-- Raw PDL data from seed  \n-- This model creates a table in the raw schema from our CSV data\n\n\n\nselect * from \"finny_db\".\"public\".\"pdl_data\"", "relation_name": "\"finny_db\".\"public_raw\".\"raw_pdl_data\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.364171Z", "completed_at": "2025-11-10T01:27:36.367632Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.368224Z", "completed_at": "2025-11-10T01:27:36.368228Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 0.004890918731689453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.raw_fxf_data", "compiled": true, "compiled_code": "-- Raw FXF data from seed\n-- This model creates a table in the raw schema from our CSV data\n\n\n\nselect * from \"finny_db\".\"public\".\"fxf_data\"", "relation_name": "\"finny_db\".\"public_raw\".\"raw_fxf_data\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.372470Z", "completed_at": "2025-11-10T01:27:36.385684Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.391799Z", "completed_at": "2025-11-10T01:27:36.391806Z"}], "thread_id": "Thread-9 (worker)", "execution_time": 0.02262425422668457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.stg_pdl_data", "compiled": true, "compiled_code": "-- Staging model for PDL data\n-- This model cleans and normalizes the raw PDL data with location parsing\n\n\n\nselect\n    pdl_id,\n    name,\n    email,\n    company,\n    company_revenue,\n    title,\n    location,\n    -- Extract city (usually the first part before comma, if comma exists)\n    case \n        when location like '%,%' then trim(split_part(location, ',', 1))\n        else null\n    end as city,\n    -- Extract and standardize state using ISO mapping\n    coalesce(\n        sim.iso_code, \n        case \n            when location like '%,%' then trim(split_part(location, ',', -1))\n            else trim(location)\n        end\n    ) as state\nfrom \"finny_db\".\"public_raw\".\"raw_pdl_data\" pdl\nleft join \"finny_db\".\"public\".\"state_iso_mapping\" sim\n    on upper(\n        case \n            when pdl.location like '%,%' then trim(split_part(pdl.location, ',', -1))\n            else trim(pdl.location)\n        end\n    ) = upper(sim.state_name)\nwhere pdl_id is not null", "relation_name": "\"finny_db\".\"public_staging\".\"stg_pdl_data\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.374153Z", "completed_at": "2025-11-10T01:27:36.388742Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.392626Z", "completed_at": "2025-11-10T01:27:36.392629Z"}], "thread_id": "Thread-5 (worker)", "execution_time": 0.02291703224182129, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.not_null_raw_pdl_data_pdl_id.b8ed29d8df", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect pdl_id\nfrom \"finny_db\".\"public_raw\".\"raw_pdl_data\"\nwhere pdl_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.380487Z", "completed_at": "2025-11-10T01:27:36.392078Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.393715Z", "completed_at": "2025-11-10T01:27:36.393719Z"}], "thread_id": "Thread-10 (worker)", "execution_time": 0.023147106170654297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.unique_raw_pdl_data_pdl_id.c28d33aeda", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    pdl_id as unique_field,\n    count(*) as n_records\n\nfrom \"finny_db\".\"public_raw\".\"raw_pdl_data\"\nwhere pdl_id is not null\ngroup by pdl_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.384381Z", "completed_at": "2025-11-10T01:27:36.392277Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.394252Z", "completed_at": "2025-11-10T01:27:36.394255Z"}], "thread_id": "Thread-13 (worker)", "execution_time": 0.023122072219848633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.raw_data_profiling", "compiled": true, "compiled_code": "-- Raw data profiling analysis\n-- This model analyzes data quality patterns in the raw data layer\n\n\n\nwith fxf_raw_profile as (\n    select\n        'fxf_data' as source_table,\n        'raw' as data_layer,\n        count(*) as total_records,\n        count(distinct fxf_id) as unique_ids,\n        count(*) - count(distinct fxf_id) as duplicate_ids,\n        count(name) as non_null_names,\n        count(*) - count(name) as null_names,\n        count(email) as non_null_emails,\n        count(*) - count(email) as null_emails,\n        count(company) as non_null_companies,\n        count(*) - count(company) as null_companies,\n        count(company_revenue) as non_null_revenues,\n        count(*) - count(company_revenue) as null_revenues,\n        count(title) as non_null_titles,\n        count(*) - count(title) as null_titles,\n        count(location) as non_null_locations,\n        count(*) - count(location) as null_locations,\n        count(distinct company) as unique_companies,\n        count(distinct location) as unique_locations,\n        count(distinct title) as unique_titles\n    from \"finny_db\".\"public_raw\".\"raw_fxf_data\"\n),\n\npdl_raw_profile as (\n    select\n        'pdl_data' as source_table,\n        'raw' as data_layer,\n        count(*) as total_records,\n        count(distinct pdl_id) as unique_ids,\n        count(*) - count(distinct pdl_id) as duplicate_ids,\n        count(name) as non_null_names,\n        count(*) - count(name) as null_names,\n        count(email) as non_null_emails,\n        count(*) - count(email) as null_emails,\n        count(company) as non_null_companies,\n        count(*) - count(company) as null_companies,\n        count(company_revenue) as non_null_revenues,\n        count(*) - count(company_revenue) as null_revenues,\n        count(title) as non_null_titles,\n        count(*) - count(title) as null_titles,\n        count(location) as non_null_locations,\n        count(*) - count(location) as null_locations,\n        count(distinct company) as unique_companies,\n        count(distinct location) as unique_locations,\n        count(distinct title) as unique_titles\n    from \"finny_db\".\"public_raw\".\"raw_pdl_data\"\n)\n\nselect * from fxf_raw_profile\nunion all\nselect * from pdl_raw_profile", "relation_name": "\"finny_db\".\"public_raw_analysis\".\"raw_data_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.383078Z", "completed_at": "2025-11-10T01:27:36.392412Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.394502Z", "completed_at": "2025-11-10T01:27:36.394505Z"}], "thread_id": "Thread-12 (worker)", "execution_time": 0.02357006072998047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.raw_company_profiling", "compiled": true, "compiled_code": "-- Company profiling analysis for raw data\n-- This model analyzes company distribution patterns in the raw data layer\n\n\n\nwith fxf_company_profile as (\n    select\n        'fxf_data' as source_table,\n        'raw' as data_layer,\n        company,\n        count(*) as employee_count,\n        count(distinct fxf_id) as unique_employees,\n        count(distinct title) as unique_titles,\n        count(distinct location) as office_locations,\n        count(company_revenue) as employees_with_revenue_info,\n        count(*) - count(company_revenue) as employees_missing_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Calculate data completeness percentages\n        round(100.0 * count(name) / count(*), 2) as name_completeness_pct,\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(title) / count(*), 2) as title_completeness_pct,\n        round(100.0 * count(location) / count(*), 2) as location_completeness_pct\n    from \"finny_db\".\"public_raw\".\"raw_fxf_data\"\n    where company is not null and trim(company) != ''\n    group by company\n),\n\npdl_company_profile as (\n    select\n        'pdl_data' as source_table,\n        'raw' as data_layer,\n        company,\n        count(*) as employee_count,\n        count(distinct pdl_id) as unique_employees,\n        count(distinct title) as unique_titles,\n        count(distinct location) as office_locations,\n        count(company_revenue) as employees_with_revenue_info,\n        count(*) - count(company_revenue) as employees_missing_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Calculate data completeness percentages\n        round(100.0 * count(name) / count(*), 2) as name_completeness_pct,\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(title) / count(*), 2) as title_completeness_pct,\n        round(100.0 * count(location) / count(*), 2) as location_completeness_pct\n    from \"finny_db\".\"public_raw\".\"raw_pdl_data\"\n    where company is not null and trim(company) != ''\n    group by company\n)\n\nselect * from fxf_company_profile\nunion all\nselect * from pdl_company_profile\norder by employee_count desc", "relation_name": "\"finny_db\".\"public_raw_analysis\".\"raw_company_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.385831Z", "completed_at": "2025-11-10T01:27:36.392942Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.394779Z", "completed_at": "2025-11-10T01:27:36.394782Z"}], "thread_id": "Thread-14 (worker)", "execution_time": 0.023329973220825195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.raw_location_profiling", "compiled": true, "compiled_code": "-- Location profiling analysis for raw data with ISO code standardization via seed\n-- This model analyzes geographic distribution patterns in the raw data\n\n\n\nwith fxf_location_profile as (\n    select\n        'fxf_data' as source_table,\n        'raw' as data_layer,\n        location,\n        -- Extract state/region (usually the last part after comma, or the whole string)\n        case \n            when location like '%,%' then trim(split_part(location, ',', -1))  -- Get the last part after comma\n            else trim(location)\n        end as state_region_raw,\n        -- Extract city (usually the first part before comma, if comma exists)\n        case \n            when location like '%,%' then trim(split_part(location, ',', 1))  -- Get the first part before comma\n            else null\n        end as city,\n        count(*) as contact_count,\n        count(distinct fxf_id) as unique_contacts,\n        count(distinct company) as company_count,\n        count(distinct title) as title_count,\n        count(company_revenue) as contacts_with_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue\n    from \"finny_db\".\"public_raw\".\"raw_fxf_data\"\n    where location is not null and trim(location) != ''\n    group by location\n),\n\nfxf_location_standardized as (\n    select \n        flp.*,\n        coalesce(sim.iso_code, flp.state_region_raw) as state_region\n    from fxf_location_profile flp\n    left join \"finny_db\".\"public\".\"state_iso_mapping\" sim\n        on upper(flp.state_region_raw) = upper(sim.state_name)\n),\n\npdl_location_profile as (\n    select\n        'pdl_data' as source_table,\n        'raw' as data_layer,\n        location,\n        -- Extract state/region (usually the last part after comma, or the whole string)\n        case \n            when location like '%,%' then trim(split_part(location, ',', -1))  -- Get the last part after comma\n            else trim(location)\n        end as state_region_raw,\n        -- Extract city (usually the first part before comma, if comma exists)\n        case \n            when location like '%,%' then trim(split_part(location, ',', 1))  -- Get the first part before comma\n            else null\n        end as city,\n        count(*) as contact_count,\n        count(distinct pdl_id) as unique_contacts,\n        count(distinct company) as company_count,\n        count(distinct title) as title_count,\n        count(company_revenue) as contacts_with_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue\n    from \"finny_db\".\"public_raw\".\"raw_pdl_data\"\n    where location is not null and trim(location) != ''\n    group by location\n),\n\npdl_location_standardized as (\n    select \n        plp.*,\n        coalesce(sim.iso_code, plp.state_region_raw) as state_region\n    from pdl_location_profile plp\n    left join \"finny_db\".\"public\".\"state_iso_mapping\" sim\n        on upper(plp.state_region_raw) = upper(sim.state_name)\n),\n\ncombined_location_profile as (\n    select\n        'combined_raw' as source_table,\n        'raw' as data_layer,\n        location,\n        state_region,\n        city,\n        sum(contact_count) as contact_count,\n        sum(unique_contacts) as unique_contacts,\n        sum(company_count) as company_count,\n        sum(title_count) as title_count,\n        sum(contacts_with_revenue) as contacts_with_revenue,\n        avg(avg_revenue) as avg_revenue,\n        min(min_revenue) as min_revenue,\n        max(max_revenue) as max_revenue,\n        null::text as state_region_raw\n    from (\n        select \n            source_table, data_layer, location, state_region, city, contact_count, unique_contacts,\n            company_count, title_count, contacts_with_revenue, avg_revenue, min_revenue, max_revenue\n        from fxf_location_standardized\n        union all\n        select \n            source_table, data_layer, location, state_region, city, contact_count, unique_contacts,\n            company_count, title_count, contacts_with_revenue, avg_revenue, min_revenue, max_revenue\n        from pdl_location_standardized\n    ) combined\n    group by location, state_region, city\n)\n\nselect \n    source_table, data_layer, location, state_region, city, contact_count, unique_contacts,\n    company_count, title_count, contacts_with_revenue, avg_revenue, min_revenue, max_revenue, state_region_raw\nfrom fxf_location_standardized\nunion all\nselect \n    source_table, data_layer, location, state_region, city, contact_count, unique_contacts,\n    company_count, title_count, contacts_with_revenue, avg_revenue, min_revenue, max_revenue, state_region_raw\nfrom pdl_location_standardized\nunion all  \nselect \n    source_table, data_layer, location, state_region, city, contact_count, unique_contacts,\n    company_count, title_count, contacts_with_revenue, avg_revenue, min_revenue, max_revenue, state_region_raw\nfrom combined_location_profile\norder by contact_count desc", "relation_name": "\"finny_db\".\"public_raw_analysis\".\"raw_location_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.387464Z", "completed_at": "2025-11-10T01:27:36.393088Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.395043Z", "completed_at": "2025-11-10T01:27:36.395047Z"}], "thread_id": "Thread-15 (worker)", "execution_time": 0.02341914176940918, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.stg_fxf_data", "compiled": true, "compiled_code": "-- Staging model for FXF data\n-- This model cleans and normalizes the raw FXF data with location parsing\n\n\n\nselect\n    fxf_id,\n    name,\n    email,\n    company,\n    company_revenue,\n    title,\n    location,\n    -- Extract city (usually the first part before comma, if comma exists)\n    case \n        when location like '%,%' then trim(split_part(location, ',', 1))\n        else null\n    end as city,\n    -- Extract and standardize state using ISO mapping\n    coalesce(\n        sim.iso_code, \n        case \n            when location like '%,%' then trim(split_part(location, ',', -1))\n            else trim(location)\n        end\n    ) as state\nfrom \"finny_db\".\"public_raw\".\"raw_fxf_data\" fxf\nleft join \"finny_db\".\"public\".\"state_iso_mapping\" sim\n    on upper(\n        case \n            when fxf.location like '%,%' then trim(split_part(fxf.location, ',', -1))\n            else trim(fxf.location)\n        end\n    ) = upper(sim.state_name)\nwhere fxf_id is not null", "relation_name": "\"finny_db\".\"public_staging\".\"stg_fxf_data\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.388921Z", "completed_at": "2025-11-10T01:27:36.393401Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.395316Z", "completed_at": "2025-11-10T01:27:36.395318Z"}], "thread_id": "Thread-16 (worker)", "execution_time": 0.02346181869506836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.not_null_raw_fxf_data_fxf_id.a66d87cfed", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect fxf_id\nfrom \"finny_db\".\"public_raw\".\"raw_fxf_data\"\nwhere fxf_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.390290Z", "completed_at": "2025-11-10T01:27:36.394106Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.395969Z", "completed_at": "2025-11-10T01:27:36.395972Z"}], "thread_id": "Thread-17 (worker)", "execution_time": 0.0239412784576416, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.unique_raw_fxf_data_fxf_id.db3ff52e66", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    fxf_id as unique_field,\n    count(*) as n_records\n\nfrom \"finny_db\".\"public_raw\".\"raw_fxf_data\"\nwhere fxf_id is not null\ngroup by fxf_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.398212Z", "completed_at": "2025-11-10T01:27:36.403070Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.410101Z", "completed_at": "2025-11-10T01:27:36.410105Z"}], "thread_id": "Thread-19 (worker)", "execution_time": 0.014585018157958984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.not_null_stg_pdl_data_pdl_id.b9ad9908b7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect pdl_id\nfrom \"finny_db\".\"public_staging\".\"stg_pdl_data\"\nwhere pdl_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.399981Z", "completed_at": "2025-11-10T01:27:36.403509Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.412955Z", "completed_at": "2025-11-10T01:27:36.412958Z"}], "thread_id": "Thread-20 (worker)", "execution_time": 0.01721501350402832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.unique_stg_pdl_data_pdl_id.0d192d34aa", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    pdl_id as unique_field,\n    count(*) as n_records\n\nfrom \"finny_db\".\"public_staging\".\"stg_pdl_data\"\nwhere pdl_id is not null\ngroup by pdl_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.406255Z", "completed_at": "2025-11-10T01:27:36.417544Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.418574Z", "completed_at": "2025-11-10T01:27:36.418577Z"}], "thread_id": "Thread-23 (worker)", "execution_time": 0.01901102066040039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.staging_city_state_profiling", "compiled": true, "compiled_code": "-- City and State profiling analysis for staging data\n-- This model analyzes geographic distribution patterns using parsed city and state fields\n\n\n\nwith fxf_city_state_profile as (\n    select\n        'stg_fxf_data' as source_table,\n        'staging' as data_layer,\n        city,\n        state,\n        location,\n        count(*) as contact_count,\n        count(distinct fxf_id) as unique_contacts,\n        count(distinct company) as company_count,\n        count(distinct title) as title_count,\n        count(company_revenue) as contacts_with_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Staging-specific metrics\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(company_revenue) / count(*), 2) as revenue_completeness_pct,\n        count(*) filter (where email is not null and email like '%@%') as valid_email_count,\n        round(100.0 * count(*) filter (where email is not null and email like '%@%') / count(*), 2) as email_validity_pct\n    from \"finny_db\".\"public_staging\".\"stg_fxf_data\"\n    where location is not null and trim(location) != ''\n    group by city, state, location\n),\n\npdl_city_state_profile as (\n    select\n        'stg_pdl_data' as source_table,\n        'staging' as data_layer,\n        city,\n        state,\n        location,\n        count(*) as contact_count,\n        count(distinct pdl_id) as unique_contacts,\n        count(distinct company) as company_count,\n        count(distinct title) as title_count,\n        count(company_revenue) as contacts_with_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Staging-specific metrics\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(company_revenue) / count(*), 2) as revenue_completeness_pct,\n        count(*) filter (where email is not null and email like '%@%') as valid_email_count,\n        round(100.0 * count(*) filter (where email is not null and email like '%@%') / count(*), 2) as email_validity_pct\n    from \"finny_db\".\"public_staging\".\"stg_pdl_data\"\n    where location is not null and trim(location) != ''\n    group by city, state, location\n)\n\nselect * from fxf_city_state_profile\nunion all\nselect * from pdl_city_state_profile\norder by contact_count desc", "relation_name": "\"finny_db\".\"public_staging_analysis\".\"staging_city_state_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.407453Z", "completed_at": "2025-11-10T01:27:36.417688Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.418850Z", "completed_at": "2025-11-10T01:27:36.418854Z"}], "thread_id": "Thread-24 (worker)", "execution_time": 0.01910090446472168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.staging_company_profiling", "compiled": true, "compiled_code": "-- Company profiling analysis for staging data with structured location data\n-- This model analyzes company distribution patterns in the cleaned staging data\n\n\n\nwith fxf_company_profile as (\n    select\n        'stg_fxf_data' as source_table,\n        'staging' as data_layer,\n        company,\n        count(*) as employee_count,\n        count(distinct fxf_id) as unique_employees,\n        count(distinct title) as unique_titles,\n        count(distinct location) as office_locations,\n        count(distinct city) as unique_cities,\n        count(distinct state) as unique_states,\n        count(company_revenue) as employees_with_revenue_info,\n        count(*) - count(company_revenue) as employees_missing_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Calculate data completeness and quality percentages\n        round(100.0 * count(name) / count(*), 2) as name_completeness_pct,\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(title) / count(*), 2) as title_completeness_pct,\n        round(100.0 * count(location) / count(*), 2) as location_completeness_pct,\n        round(100.0 * count(city) / count(*), 2) as city_completeness_pct,\n        round(100.0 * count(state) / count(*), 2) as state_completeness_pct,\n        -- Staging-specific quality metrics\n        count(*) filter (where email is not null and email like '%@%') as valid_email_count,\n        round(100.0 * count(*) filter (where email is not null and email like '%@%') / count(*), 2) as email_validity_pct,\n        count(distinct case when email like '%@%' then split_part(email, '@', 2) end) as email_domain_count\n    from \"finny_db\".\"public_staging\".\"stg_fxf_data\"\n    where company is not null and trim(company) != ''\n    group by company\n),\n\npdl_company_profile as (\n    select\n        'stg_pdl_data' as source_table,\n        'staging' as data_layer,\n        company,\n        count(*) as employee_count,\n        count(distinct pdl_id) as unique_employees,\n        count(distinct title) as unique_titles,\n        count(distinct location) as office_locations,\n        count(distinct city) as unique_cities,\n        count(distinct state) as unique_states,\n        count(company_revenue) as employees_with_revenue_info,\n        count(*) - count(company_revenue) as employees_missing_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Calculate data completeness and quality percentages\n        round(100.0 * count(name) / count(*), 2) as name_completeness_pct,\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(title) / count(*), 2) as title_completeness_pct,\n        round(100.0 * count(location) / count(*), 2) as location_completeness_pct,\n        round(100.0 * count(city) / count(*), 2) as city_completeness_pct,\n        round(100.0 * count(state) / count(*), 2) as state_completeness_pct,\n        -- Staging-specific quality metrics\n        count(*) filter (where email is not null and email like '%@%') as valid_email_count,\n        round(100.0 * count(*) filter (where email is not null and email like '%@%') / count(*), 2) as email_validity_pct,\n        count(distinct case when email like '%@%' then split_part(email, '@', 2) end) as email_domain_count\n    from \"finny_db\".\"public_staging\".\"stg_pdl_data\"\n    where company is not null and trim(company) != ''\n    group by company\n)\n\nselect * from fxf_company_profile\nunion all\nselect * from pdl_company_profile\norder by employee_count desc", "relation_name": "\"finny_db\".\"public_staging_analysis\".\"staging_company_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.404068Z", "completed_at": "2025-11-10T01:27:36.417848Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.419662Z", "completed_at": "2025-11-10T01:27:36.419665Z"}], "thread_id": "Thread-22 (worker)", "execution_time": 0.021677255630493164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.company_analysis", "compiled": true, "compiled_code": "-- Combined company analysis from both FXF and PDL data sources with structured location data\n\n\n\nwith fxf_companies as (\n    select\n        'fxf' as data_source,\n        company,\n        count(*) as employee_count,\n        count(distinct title) as unique_titles,\n        avg(company_revenue) as avg_revenue,\n        array_agg(distinct location) as locations,\n        array_agg(distinct city) filter (where city is not null) as cities,\n        array_agg(distinct state) filter (where state is not null) as states,\n        count(distinct city) as unique_cities,\n        count(distinct state) as unique_states\n    from \"finny_db\".\"public_staging\".\"stg_fxf_data\"\n    where company is not null\n    group by company\n),\n\npdl_companies as (\n    select\n        'pdl' as data_source,\n        company,\n        count(*) as employee_count,\n        count(distinct title) as unique_titles,\n        avg(company_revenue) as avg_revenue,\n        array_agg(distinct location) as locations,\n        array_agg(distinct city) filter (where city is not null) as cities,\n        array_agg(distinct state) filter (where state is not null) as states,\n        count(distinct city) as unique_cities,\n        count(distinct state) as unique_states\n    from \"finny_db\".\"public_staging\".\"stg_pdl_data\"\n    where company is not null\n    group by company\n),\n\ncombined_companies as (\n    select * from fxf_companies\n    union all\n    select * from pdl_companies\n)\n\nselect\n    company,\n    array_agg(distinct data_source) as data_sources,\n    sum(employee_count) as total_employees,\n    sum(unique_titles) as total_unique_titles,\n    avg(avg_revenue) as average_revenue,\n    sum(unique_cities) as total_unique_cities,\n    sum(unique_states) as total_unique_states,\n    array_agg(distinct location_item) filter (where location_item is not null) as all_locations,\n    array_agg(distinct city_item) filter (where city_item is not null) as all_cities,\n    array_agg(distinct state_item) filter (where state_item is not null) as all_states\nfrom (\n    select \n        company, data_source, employee_count, unique_titles, avg_revenue, unique_cities, unique_states,\n        unnest(locations) as location_item,\n        unnest(cities) as city_item,\n        unnest(states) as state_item\n    from combined_companies\n) expanded\ngroup by company\norder by total_employees desc", "relation_name": "\"finny_db\".\"public_staging_analysis\".\"company_analysis\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.408802Z", "completed_at": "2025-11-10T01:27:36.418054Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.419878Z", "completed_at": "2025-11-10T01:27:36.419881Z"}], "thread_id": "Thread-25 (worker)", "execution_time": 0.01864910125732422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.staging_data_profiling", "compiled": true, "compiled_code": "-- Staging data profiling analysis\n-- This model analyzes data quality patterns in the staging data layer\n\n\n\nwith fxf_staging_profile as (\n    select\n        'stg_fxf_data' as source_table,\n        'staging' as data_layer,\n        count(*) as total_records,\n        count(distinct fxf_id) as unique_ids,\n        count(*) - count(distinct fxf_id) as duplicate_ids,\n        count(name) as non_null_names,\n        count(*) - count(name) as null_names,\n        count(email) as non_null_emails,\n        count(*) - count(email) as null_emails,\n        count(company) as non_null_companies,\n        count(*) - count(company) as null_companies,\n        count(company_revenue) as non_null_revenues,\n        count(*) - count(company_revenue) as null_revenues,\n        count(title) as non_null_titles,\n        count(*) - count(title) as null_titles,\n        count(location) as non_null_locations,\n        count(*) - count(location) as null_locations,\n        count(distinct company) as unique_companies,\n        count(distinct location) as unique_locations,\n        count(distinct title) as unique_titles,\n        -- Staging-specific metrics\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(company_revenue) / count(*), 2) as revenue_completeness_pct,\n        round(avg(company_revenue)::numeric, 0) as avg_company_revenue,\n        max(company_revenue) as max_company_revenue,\n        min(company_revenue) as min_company_revenue\n    from \"finny_db\".\"public_staging\".\"stg_fxf_data\"\n),\n\npdl_staging_profile as (\n    select\n        'stg_pdl_data' as source_table,\n        'staging' as data_layer,\n        count(*) as total_records,\n        count(distinct pdl_id) as unique_ids,\n        count(*) - count(distinct pdl_id) as duplicate_ids,\n        count(name) as non_null_names,\n        count(*) - count(name) as null_names,\n        count(email) as non_null_emails,\n        count(*) - count(email) as null_emails,\n        count(company) as non_null_companies,\n        count(*) - count(company) as null_companies,\n        count(company_revenue) as non_null_revenues,\n        count(*) - count(company_revenue) as null_revenues,\n        count(title) as non_null_titles,\n        count(*) - count(title) as null_titles,\n        count(location) as non_null_locations,\n        count(*) - count(location) as null_locations,\n        count(distinct company) as unique_companies,\n        count(distinct location) as unique_locations,\n        count(distinct title) as unique_titles,\n        -- Staging-specific metrics\n        round(100.0 * count(email) / count(*), 2) as email_completeness_pct,\n        round(100.0 * count(company_revenue) / count(*), 2) as revenue_completeness_pct,\n        round(avg(company_revenue)::numeric, 0) as avg_company_revenue,\n        max(company_revenue) as max_company_revenue,\n        min(company_revenue) as min_company_revenue\n    from \"finny_db\".\"public_staging\".\"stg_pdl_data\"\n)\n\nselect * from fxf_staging_profile\nunion all\nselect * from pdl_staging_profile\norder by total_records desc", "relation_name": "\"finny_db\".\"public_staging_analysis\".\"staging_data_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.410354Z", "completed_at": "2025-11-10T01:27:36.418317Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.420087Z", "completed_at": "2025-11-10T01:27:36.420090Z"}], "thread_id": "Thread-26 (worker)", "execution_time": 0.01867985725402832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.staging_location_profiling", "compiled": true, "compiled_code": "-- Location profiling analysis for staging data using structured city and state fields\n-- This model analyzes geographic distribution patterns in the cleaned staging data\n\n\n\nwith fxf_location_profile as (\n    select\n        'stg_fxf_data' as source_table,\n        'staging' as data_layer,\n        location,\n        city,\n        state,\n        count(*) as contact_count,\n        count(distinct fxf_id) as unique_contacts,\n        count(distinct company) as company_count,\n        count(distinct title) as title_count,\n        count(company_revenue) as contacts_with_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Staging-specific quality metrics\n        count(*) filter (where name is not null and trim(name) != '') as contacts_with_name,\n        count(*) filter (where email is not null and email like '%@%') as contacts_with_valid_email,\n        round(100.0 * count(*) filter (where email is not null and email like '%@%') / count(*), 2) as email_validity_pct\n    from \"finny_db\".\"public_staging\".\"stg_fxf_data\"\n    where location is not null and trim(location) != ''\n    group by location, city, state\n),\n\npdl_location_profile as (\n    select\n        'stg_pdl_data' as source_table,\n        'staging' as data_layer,\n        location,\n        city,\n        state,\n        count(*) as contact_count,\n        count(distinct pdl_id) as unique_contacts,\n        count(distinct company) as company_count,\n        count(distinct title) as title_count,\n        count(company_revenue) as contacts_with_revenue,\n        avg(company_revenue) as avg_revenue,\n        min(company_revenue) as min_revenue,\n        max(company_revenue) as max_revenue,\n        -- Staging-specific quality metrics\n        count(*) filter (where name is not null and trim(name) != '') as contacts_with_name,\n        count(*) filter (where email is not null and email like '%@%') as contacts_with_valid_email,\n        round(100.0 * count(*) filter (where email is not null and email like '%@%') / count(*), 2) as email_validity_pct\n    from \"finny_db\".\"public_staging\".\"stg_pdl_data\"\n    where location is not null and trim(location) != ''\n    group by location, city, state\n),\n\ncombined_location_profile as (\n    select\n        'combined_staging' as source_table,\n        'staging' as data_layer,\n        location,\n        city,\n        state,\n        sum(contact_count) as contact_count,\n        sum(unique_contacts) as unique_contacts,\n        sum(company_count) as company_count,\n        sum(title_count) as title_count,\n        sum(contacts_with_revenue) as contacts_with_revenue,\n        avg(avg_revenue) as avg_revenue,\n        min(min_revenue) as min_revenue,\n        max(max_revenue) as max_revenue,\n        sum(contacts_with_name) as contacts_with_name,\n        sum(contacts_with_valid_email) as contacts_with_valid_email,\n        round(100.0 * sum(contacts_with_valid_email) / sum(contact_count), 2) as email_validity_pct\n    from (\n        select * from fxf_location_profile\n        union all\n        select * from pdl_location_profile\n    ) combined\n    group by location, city, state\n)\n\nselect * from fxf_location_profile\nunion all\nselect * from pdl_location_profile\nunion all  \nselect * from combined_location_profile\norder by contact_count desc", "relation_name": "\"finny_db\".\"public_staging_analysis\".\"staging_location_profiling\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.411795Z", "completed_at": "2025-11-10T01:27:36.419133Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.420395Z", "completed_at": "2025-11-10T01:27:36.420397Z"}], "thread_id": "Thread-17 (worker)", "execution_time": 0.018793344497680664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.stg_unified_prospects", "compiled": true, "compiled_code": "-- Unified prospect records from both FXF and PDL sources\n-- This model combines both datasets into a single standardized format\n\n\n\nwith fxf_prospects as (\n    select\n        'fxf' as data_source,\n        fxf_id as source_id,\n        name,\n        email,\n        company,\n        title,\n        location,\n        city,\n        state,\n        company_revenue,\n        -- Add source-specific fields as nulls for consistency\n        null as pdl_id\n    from \"finny_db\".\"public_staging\".\"stg_fxf_data\"\n),\n\npdl_prospects as (\n    select\n        'pdl' as data_source,\n        pdl_id as source_id,\n        name,\n        email,\n        company,\n        title,\n        location,\n        city,\n        state,\n        company_revenue,\n        -- Add source-specific fields as nulls for consistency\n        null as fxf_id\n    from \"finny_db\".\"public_staging\".\"stg_pdl_data\"\n),\n\nunified_prospects as (\n    select\n        row_number() over (order by data_source, source_id) as prospect_id,\n        data_source,\n        source_id,\n        case when data_source = 'fxf' then source_id else null end as fxf_id,\n        case when data_source = 'pdl' then source_id else null end as pdl_id,\n        name,\n        email,\n        company,\n        title,\n        location,\n        city,\n        state,\n        company_revenue,\n        'unidentified' as status  -- Status for prospects not yet processed for matching\n    from (\n        select * from fxf_prospects\n        union all\n        select * from pdl_prospects\n    ) combined\n)\n\nselect * from unified_prospects\norder by prospect_id", "relation_name": "\"finny_db\".\"public_staging\".\"stg_unified_prospects\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.414555Z", "completed_at": "2025-11-10T01:27:36.419278Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.420637Z", "completed_at": "2025-11-10T01:27:36.420639Z"}], "thread_id": "Thread-28 (worker)", "execution_time": 0.018628835678100586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.not_null_stg_fxf_data_fxf_id.76da6d0fbe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect fxf_id\nfrom \"finny_db\".\"public_staging\".\"stg_fxf_data\"\nwhere fxf_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.413203Z", "completed_at": "2025-11-10T01:27:36.419409Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.420854Z", "completed_at": "2025-11-10T01:27:36.420857Z"}], "thread_id": "Thread-27 (worker)", "execution_time": 0.019103050231933594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.not_null_stg_fxf_data_email.547af3f2d1", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect email\nfrom \"finny_db\".\"public_staging\".\"stg_fxf_data\"\nwhere email is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.415913Z", "completed_at": "2025-11-10T01:27:36.419538Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.421113Z", "completed_at": "2025-11-10T01:27:36.421116Z"}], "thread_id": "Thread-29 (worker)", "execution_time": 0.018927335739135742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.unique_stg_fxf_data_fxf_id.b81bfb9c25", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    fxf_id as unique_field,\n    count(*) as n_records\n\nfrom \"finny_db\".\"public_staging\".\"stg_fxf_data\"\nwhere fxf_id is not null\ngroup by fxf_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.424519Z", "completed_at": "2025-11-10T01:27:36.429268Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.429741Z", "completed_at": "2025-11-10T01:27:36.429746Z"}], "thread_id": "Thread-32 (worker)", "execution_time": 0.007524967193603516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.unique_company_analysis_company.2a96b2dba1", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    company as unique_field,\n    count(*) as n_records\n\nfrom \"finny_db\".\"public_staging_analysis\".\"company_analysis\"\nwhere company is not null\ngroup by company\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.423087Z", "completed_at": "2025-11-10T01:27:36.429429Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.430024Z", "completed_at": "2025-11-10T01:27:36.430027Z"}], "thread_id": "Thread-31 (worker)", "execution_time": 0.007986068725585938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.dbt_service.not_null_company_analysis_company.b4c562fde2", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect company\nfrom \"finny_db\".\"public_staging_analysis\".\"company_analysis\"\nwhere company is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.425782Z", "completed_at": "2025-11-10T01:27:36.429563Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.430242Z", "completed_at": "2025-11-10T01:27:36.430244Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007821083068847656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.stg_prospect_matches", "compiled": true, "compiled_code": "-- Prospect similarity matching for deduplication\n-- This model identifies potential duplicate prospects based on name, email, and company similarity\n\n\n\nWITH base AS (\n  SELECT *\n  FROM \"finny_db\".\"public_staging\".\"stg_unified_prospects\"\n  WHERE status IS DISTINCT FROM 'merged'\n    AND prospect_id <= 2000000  -- Increase to 10000 records\n  \n    -- Only process new prospects in incremental runs\n    AND prospect_id > (SELECT COALESCE(MAX(source_id), 0) FROM \"finny_db\".\"public_staging\".\"stg_prospect_matches\")\n  \n),\n\npairs AS (\n  SELECT \n    a.prospect_id AS source_id,\n    b.prospect_id AS target_id,\n    similarity(a.name, b.name) AS name_sim,\n    similarity(a.email, b.email) AS email_sim,\n    similarity(a.company, b.company) AS company_sim,\n    (\n      0.5 * similarity(a.name, b.name) +\n      0.4 * similarity(a.email, b.email) +\n      0.1 * similarity(a.company, b.company)\n    ) AS total_score\n  FROM base a\n  JOIN base b\n    ON a.prospect_id < b.prospect_id\n  WHERE (\n    similarity(a.name, b.name) > 0.5 and  -- Lower threshold\n    similarity(a.email, b.email) > 0.4   -- Lower threshold\n  )\n)\n\nSELECT \n  source_id,\n  target_id,\n  name_sim,\n  email_sim,\n  company_sim,\n  total_score\nFROM pairs\nWHERE total_score > 0.6  -- Lower threshold for final results", "relation_name": "\"finny_db\".\"public_staging\".\"stg_prospect_matches\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.431460Z", "completed_at": "2025-11-10T01:27:36.434827Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.434986Z", "completed_at": "2025-11-10T01:27:36.434990Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0041790008544921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.prospect_matching_ratio", "compiled": true, "compiled_code": "-- Prospect matching ratio analysis\n-- This model shows the distribution of unidentified vs matched prospects\n\n\n\nwith prospect_status_summary as (\n    select\n        status,\n        count(*) as prospect_count,\n        round(100.0 * count(*) / sum(count(*)) over(), 2) as percentage\n    from \"finny_db\".\"public_staging\".\"stg_unified_prospects\"\n    group by status\n),\n\nmatching_summary as (\n    select\n        count(*) as total_matches,\n        count(distinct source_id) as unique_sources_matched,\n        count(distinct target_id) as unique_targets_matched\n    from \"finny_db\".\"public_staging\".\"stg_prospect_matches\"\n),\n\nratio_analysis as (\n    select\n        'Total Prospects' as metric_type,\n        sum(prospect_count) as value,\n        'prospects' as unit,\n        null as percentage\n    from prospect_status_summary\n    \n    union all\n    \n    select\n        'Unidentified Prospects' as metric_type,\n        prospect_count as value,\n        'prospects' as unit,\n        percentage\n    from prospect_status_summary\n    where status = 'unidentified'\n    \n    union all\n    \n    select\n        'Merged Prospects' as metric_type,\n        prospect_count as value,\n        'prospects' as unit,\n        percentage\n    from prospect_status_summary\n    where status = 'merged'\n    \n    union all\n    \n    select\n        'Potential Matches Found' as metric_type,\n        total_matches as value,\n        'match pairs' as unit,\n        null as percentage\n    from matching_summary\n    \n    union all\n    \n    select\n        'Unique Prospects with Matches' as metric_type,\n        (unique_sources_matched + unique_targets_matched) as value,\n        'prospects' as unit,\n        round(100.0 * (unique_sources_matched + unique_targets_matched) / \n              (select sum(prospect_count) from prospect_status_summary), 2) as percentage\n    from matching_summary\n)\n\nselect \n    metric_type,\n    value,\n    unit,\n    case \n        when percentage is not null then percentage || '%'\n        else null\n    end as percentage\nfrom ratio_analysis\norder by \n    case metric_type\n        when 'Total Prospects' then 1\n        when 'Unidentified Prospects' then 2  \n        when 'Merged Prospects' then 3\n        when 'Potential Matches Found' then 4\n        when 'Unique Prospects with Matches' then 5\n    end", "relation_name": "\"finny_db\".\"public_marts\".\"prospect_matching_ratio\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.433741Z", "completed_at": "2025-11-10T01:27:36.435237Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.435411Z", "completed_at": "2025-11-10T01:27:36.435414Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.004135847091674805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.stg_entity_clusters", "compiled": true, "compiled_code": "-- Entity clusters for prospect deduplication\n-- This model identifies canonical (primary) records and duplicates to be merged\n-- Results:\n\n-- 87 duplicate pairs identified from high-confidence matches (score > 0.8)\n-- Canonical ID logic: Uses the higher prospect_id as canonical (keeps the \"later\" record)\n-- Merged ID logic: Lower prospect_id will be marked as duplicate\n-- Range: Processing prospects from 658 to 9999\n-- How it works:\n\n-- Example: Prospect 658 is canonical, Prospect 291 should be merged into it\n-- etc.\n\n\n\nWITH ranked AS (\n  SELECT \n    *,\n    GREATEST(source_id, target_id) AS canonical_id,\n    LEAST(source_id, target_id) AS merged_id\n  FROM \"finny_db\".\"public_staging\".\"stg_prospect_matches\"\n  WHERE total_score > 0.8  -- Only high-confidence matches\n)\n\nSELECT DISTINCT \n  canonical_id, \n  merged_id,\n  'duplicate' as merge_reason\nFROM ranked\nORDER BY canonical_id, merged_id", "relation_name": "\"finny_db\".\"public_staging\".\"stg_entity_clusters\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.436677Z", "completed_at": "2025-11-10T01:27:36.439111Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.439287Z", "completed_at": "2025-11-10T01:27:36.439291Z"}], "thread_id": "Thread-7 (worker)", "execution_time": 0.0032591819763183594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.data_overview", "compiled": true, "compiled_code": "-- Data overview from deduplication pipeline\n-- This model provides a summary of our prospect matching and deduplication results\n\n\n\nselect\n    'stg_unified_prospects' as table_name,\n    'staging' as schema_name,\n    count(*) as row_count,\n    'Total unified prospects before deduplication' as description\nfrom \"finny_db\".\"public_staging\".\"stg_unified_prospects\"\n\nunion all\n\nselect\n    'stg_prospect_matches' as table_name,\n    'staging' as schema_name,\n    count(*) as row_count,\n    'Potential duplicate pairs identified' as description\nfrom \"finny_db\".\"public_staging\".\"stg_prospect_matches\"\n\nunion all\n\nselect\n    'stg_entity_clusters' as table_name,\n    'staging' as schema_name,\n    count(*) as row_count,\n    'High-confidence duplicates for merging' as description\nfrom \"finny_db\".\"public_staging\".\"stg_entity_clusters\"\n\nunion all\n\nselect\n    'unique_prospects_remaining' as table_name,\n    'computed' as schema_name,\n    count(*) as row_count,\n    'Unidentified prospects (not yet matched as duplicates)' as description\nfrom \"finny_db\".\"public_staging\".\"stg_unified_prospects\"\nwhere status is distinct from 'merged'", "relation_name": "\"finny_db\".\"public_marts\".\"data_overview\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-10T01:27:36.438039Z", "completed_at": "2025-11-10T01:27:36.439526Z"}, {"name": "execute", "started_at": "2025-11-10T01:27:36.439716Z", "completed_at": "2025-11-10T01:27:36.439719Z"}], "thread_id": "Thread-11 (worker)", "execution_time": 0.003526926040649414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.dbt_service.setup_functions", "compiled": true, "compiled_code": "-- Database function setup for deduplication pipeline\n-- This model ensures the merge_similar_entities() function exists in the database\n\n\n\nselect 'Function merge_similar_entities() created' as status", "relation_name": "\"finny_db\".\"public\".\"setup_functions\"", "batch_results": null}], "elapsed_time": 0.24172306060791016, "args": {"skip_nodes_if_on_run_start_fails": false, "exclude": [], "indirect_selection": "eager", "populate_cache": true, "invocation_command": "dbt docs generate --project-dir dbt_service --profiles-dir dbt_service", "log_format": "default", "print": true, "version_check": true, "require_explicit_package_overrides_for_builtin_materializations": true, "strict_mode": false, "use_colors": true, "require_all_warnings_handled_by_warn_error": false, "favor_state": false, "introspect": true, "show_resource_report": false, "show_all_deprecations": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "compile": true, "select": [], "validate_macro_args": false, "static": false, "use_fast_test_edges": false, "state_modified_compare_vars": false, "log_level": "info", "require_nested_cumulative_type_params": false, "log_level_file": "debug", "require_yaml_configuration_for_mf_time_spines": false, "require_generic_test_arguments_property": true, "cache_selected_only": false, "upload_to_artifacts_ingest_api": false, "vars": {}, "log_file_max_bytes": 10485760, "empty_catalog": false, "log_path": "dbt_service/logs", "require_batched_execution_for_custom_microbatch_strategy": false, "quiet": false, "defer": false, "send_anonymous_usage_stats": true, "which": "generate", "partial_parse": true, "source_freshness_run_project_hooks": true, "use_colors_file": true, "macro_debugging": false, "profiles_dir": "dbt_service", "printer_width": 80, "static_parser": true, "require_resource_names_without_spaces": true, "project_dir": "dbt_service", "write_json": true, "partial_parse_file_diff": true, "log_format_file": "debug", "state_modified_compare_more_unrendered_values": false}}